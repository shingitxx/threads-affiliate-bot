<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Threadsè‡ªå‹•ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ  - ç®¡ç†ç”»é¢ï¼ˆå®Œæˆç‰ˆï¼‰</title>
  <style>
    :root {
      --primary-color: #1a73e8;
      --success-color: #34a853;
      --warning-color: #fbbc04;
      --danger-color: #ea4335;
      --dark-color: #202124;
      --light-color: #f8f9fa;
      --border-color: #dadce0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light-color);
      color: var(--dark-color);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .header h1 {
      color: var(--primary-color);
      margin-bottom: 10px;
    }

    .status-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: var(--light-color);
      border-radius: 4px;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--success-color);
    }

    .status-indicator.loading {
      animation: pulse 2s infinite;
    }

    .status-indicator.error {
      background: var(--danger-color);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border-left: 4px solid var(--primary-color);
    }

    .card h3 {
      margin-bottom: 10px;
      color: var(--dark-color);
    }

    .card .value {
      font-size: 2em;
      font-weight: bold;
      color: var(--primary-color);
    }

    .buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: #1557b0;
    }

    .btn-success {
      background: var(--success-color);
      color: white;
    }

    .btn-success:hover {
      background: #2d8f47;
    }

    .btn-warning {
      background: var(--warning-color);
      color: var(--dark-color);
    }

    .btn-warning:hover {
      background: #f9ab00;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .section h2 {
      margin-bottom: 15px;
      color: var(--dark-color);
    }

    .account-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .account-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--light-color);
      border-radius: 4px;
      border-left: 3px solid var(--success-color);
    }

    .account-info .account-name {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .account-info .account-status {
      font-size: 0.9em;
      color: #666;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 500;
    }

    .status-badge.status-active {
      background: #e8f5e8;
      color: var(--success-color);
    }

    .status-badge.status-error {
      background: #fce8e6;
      color: var(--danger-color);
    }

    .spinner {
      border: 3px solid var(--gray-200);
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .log-area {
      background: #1a1a1a;
      color: #f0f0f0;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      height: 300px;
      overflow-y: auto;
      margin-top: 10px;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 2px 0;
    }

    .log-entry.success {
      color: #4caf50;
    }

    .log-entry.error {
      color: #f44336;
    }

    .log-entry.warning {
      color: #ff9800;
    }

    .log-entry.info {
      color: #2196f3;
    }

    .log-time {
      color: #888;
      margin-right: 8px;
    }

    .alert {
      padding: 12px 16px;
      border-radius: 4px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: opacity 0.3s;
    }

    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .alert-warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .debug-panel {
      background: #f1f3f4;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid var(--warning-color);
    }

    .debug-panel h3 {
      color: var(--warning-color);
      margin-bottom: 10px;
    }

    .debug-info {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      background: white;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
    }

    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      .grid {
        grid-template-columns: 1fr;
      }

      .buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
      <h1>ğŸ§µ Threadsè‡ªå‹•ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆå®Œæˆç‰ˆï¼‰</h1>
      <div class="status-bar">
        <div id="statusIndicator" class="status-indicator"></div>
        <span id="statusText">ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªä¸­...</span>
        <span style="margin-left: auto; font-size: 0.9em;" id="lastUpdate">æœ€çµ‚æ›´æ–°: --:--</span>
      </div>
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
    <div class="debug-panel" id="debugPanel">
      <h3>ğŸ”§ ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h3>
      <div class="debug-info" id="debugInfo">
        ç’°å¢ƒãƒã‚§ãƒƒã‚¯ä¸­...
      </div>
    </div>

    <!-- ã‚¢ãƒ©ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="alertContainer"></div>

    <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ã‚«ãƒ¼ãƒ‰ -->
    <div class="grid">
      <div class="card" id="accountsCard">
        <h3>ğŸ‘¥ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h3>
        <div class="value" id="activeAccounts">--</div>
      </div>
      <div class="card" id="postsCard">
        <h3>ğŸ“ ä»Šæ—¥ã®æŠ•ç¨¿</h3>
        <div class="value" id="todayPosts">--</div>
      </div>
      <div class="card" id="successCard">
        <h3>ğŸ“ˆ æˆåŠŸç‡</h3>
        <div class="value" id="successRate">--%</div>
      </div>
      <div class="card" id="contentCard">
        <h3>ğŸ“„ åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</h3>
        <div class="value" id="availableContent">--</div>
      </div>
    </div>

    <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
    <div class="buttons">
      <button class="btn btn-primary" id="executeAllBtn" onclick="executeAllAccountsFixed()" title="æœ€å¤§5åˆ†ã®å‡¦ç†æ™‚é–“">
        <span class="btn-text">ğŸš€ å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œ</span>
      </button>
      <button class="btn btn-success" id="executeSingleBtn" onclick="executeSingleAccountFixed()" title="æ¨å¥¨ï¼šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå›é¿">
        <span class="btn-text">ğŸ‘¤ å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿ï¼ˆæ¨å¥¨ï¼‰</span>
      </button>
      <button class="btn btn-warning" id="executeTestBtn" onclick="executeTestFixed()">
        <span class="btn-text">ğŸ§ª ãƒ†ã‚¹ãƒˆæŠ•ç¨¿</span>
      </button>
      <button class="btn btn-primary" onclick="refreshStatusFixed()">
        <span class="btn-text">ğŸ”„ çŠ¶æ³æ›´æ–°</span>
      </button>
      <button class="btn btn-primary" onclick="refreshStatusNew()">
        <span class="btn-text">ğŸ†• æ–°ã—ã„çŠ¶æ³æ›´æ–°</span>
      </button>
      <button class="btn btn-warning" onclick="testAllFunctions()">
        <span class="btn-text">ğŸ§ª å…¨é–¢æ•°ãƒ†ã‚¹ãƒˆ</span>
      </button>
      <button class="btn btn-success" onclick="setupScheduleFromUI()">
        <span class="btn-text">ğŸ• æ™‚é–“æŒ‡å®šæŠ•ç¨¿è¨­å®š</span>
      </button>
      <button class="btn btn-primary" onclick="checkScheduleFromUI()">
        <span class="btn-text">ğŸ“Š ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª</span>
      </button>
      <button class="btn btn-warning" onclick="stopScheduleFromUI()">
        <span class="btn-text">ğŸ›‘ æ™‚é–“æŒ‡å®šæŠ•ç¨¿åœæ­¢</span>
      </button>
      <button class="btn btn-warning" onclick="performHealthCheckFixed()">
        <span class="btn-text">âš•ï¸ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</span>
      </button>
      <button class="btn btn-warning" onclick="testBackendConnectionFixed()">
        <span class="btn-text">ğŸ”§ æ¥ç¶šãƒ†ã‚¹ãƒˆ</span>
      </button>
      <button class="btn btn-warning" onclick="testDirectConnectionFixed()">
        <span class="btn-text">ğŸ¯ ç›´æ¥æ¥ç¶šãƒ†ã‚¹ãƒˆ</span>
      </button>
    </div>

    <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ -->
    <div class="section">
      <h2>ğŸ‘¥ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†</h2>
      <div id="accountList" class="account-list">
        <div class="loading-placeholder">
          <span>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
        </div>
      </div>
    </div>

    <!-- ãƒ­ã‚°è¡¨ç¤º -->
    <div class="section">
      <h2>ğŸ“‹ å®Ÿè¡Œãƒ­ã‚°</h2>
      <div id="logArea" class="log-area"></div>
    </div>
  </div>

  <script>
    // ğŸ”§ ã€å®Œæˆç‰ˆã€‘åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ããƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ãƒ»çŠ¶æ…‹ç®¡ç†
    const AppState = {
        isLoading: false,
        systemHealth: null,
        lastUpdate: null,
        activeOperations: new Set(),
        debugMode: true,
        environmentCheck: {
            googleScript: false,
            functionsAvailable: [],
            lastError: null
        }
    };

    // è¨­å®š
    const CONFIG = {
        MAX_LOG_ENTRIES: 100,
        ALERT_AUTO_DISMISS: 5000,
        MAX_RETRIES: 3,
        RETRY_DELAY: 2000,
        TIMEOUT: 30000
    };

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸš€ Threadsè‡ªå‹•ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ  UI èµ·å‹•ï¼ˆå®Œæˆç‰ˆï¼‰');
        
        initializeApp();
        performEnvironmentCheck();
        
        addLog('info', 'âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åˆæœŸåŒ–å®Œäº†ï¼ˆå®Œæˆç‰ˆï¼‰');
    });

    function initializeApp() {
        try {
            updateSystemStatus('loading', 'ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªä¸­...');
            updateDebugInfo('ç’°å¢ƒãƒã‚§ãƒƒã‚¯é–‹å§‹...\n');
            console.log('âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–å®Œäº†');
        } catch (error) {
            console.error('âŒ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            showAlert('error', 'ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    // ğŸ”§ ç’°å¢ƒãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
    function performEnvironmentCheck() {
        addLog('info', 'ğŸ” ç’°å¢ƒãƒã‚§ãƒƒã‚¯é–‹å§‹');
        updateDebugInfo('ç’°å¢ƒãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­...\n');
        
        try {
            const checks = {
                googleObject: typeof google !== 'undefined',
                googleScript: false,
                googleScriptRun: false
            };
            
            if (checks.googleObject) {
                checks.googleScript = !!google.script;
                if (checks.googleScript) {
                    checks.googleScriptRun = !!google.script.run;
                }
            }
            
            AppState.environmentCheck = {
                ...checks,
                timestamp: new Date().toISOString()
            };
            
            let debugText = '=== ç’°å¢ƒãƒã‚§ãƒƒã‚¯çµæœ ===\n';
            debugText += `google ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ: ${checks.googleObject ? 'âœ…' : 'âŒ'}\n`;
            debugText += `google.script: ${checks.googleScript ? 'âœ…' : 'âŒ'}\n`;
            debugText += `google.script.run: ${checks.googleScriptRun ? 'âœ…' : 'âŒ'}\n`;
            
            if (checks.googleScriptRun) {
                debugText += '\nğŸš€ Google Apps Scriptç’°å¢ƒç¢ºèªå®Œäº†\n';
                debugText += 'åˆå›ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚’é–‹å§‹ã—ã¾ã™...\n';
                updateDebugInfo(debugText);
                
                setTimeout(() => {
                    performInitialLoad();
                }, 1000);
            } else {
                debugText += '\nâŒ Google Apps Scriptç’°å¢ƒãŒåˆ©ç”¨ã§ãã¾ã›ã‚“\n';
                debugText += 'ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„\n';
                updateDebugInfo(debugText);
                
                updateSystemStatus('error', 'Google Apps Scriptç’°å¢ƒã‚¨ãƒ©ãƒ¼');
                showAlert('error', 'Google Apps Scriptç’°å¢ƒãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
            
        } catch (error) {
            console.error('âŒ ç’°å¢ƒãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', error);
            updateDebugInfo(`ç’°å¢ƒãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            showAlert('error', 'ç’°å¢ƒãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    async function performInitialLoad() {
        try {
            addLog('info', 'ğŸ”„ åˆå›ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹ï¼ˆå‹•ä½œç¢ºèªæ¸ˆã¿ï¼‰');
            updateDebugInfo('åˆå›ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ - å‹•ä½œç¢ºèªæ¸ˆã¿é–¢æ•°ä½¿ç”¨\n');
            
            await refreshStatusNew();
            
            addLog('success', 'âœ… åˆå›ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†');
            updateSystemStatus('healthy', 'ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒä¸­');
            
        } catch (error) {
            console.error('âŒ åˆå›ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            addLog('warning', 'âš ï¸ è‡ªå‹•èª­ã¿è¾¼ã¿å¤±æ•— - æ‰‹å‹•æ›´æ–°ã‚’ãŠè©¦ã—ãã ã•ã„');
            updateSystemStatus('warning', 'æ‰‹å‹•æ›´æ–°ãŒå¿…è¦');
            updateDebugInfo(`âš ï¸ åˆå›èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
        }
    }

    // ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–¢æ•°å‘¼ã³å‡ºã—
    async function callBackendFunction(functionName, params = null, options = {}) {
        const {
            retries = CONFIG.MAX_RETRIES,
            timeout = CONFIG.TIMEOUT,
            showLoading = true,
            operationId = null
        } = options;
        
        if (!AppState.environmentCheck.googleScriptRun) {
            throw new Error('Google Apps Scriptç’°å¢ƒãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
        }
        
        if (showLoading && operationId) {
            AppState.activeOperations.add(operationId);
            updateLoadingState();
        }
        
        let attempt = 0;
        let lastError = null;
        
        while (attempt < retries) {
            try {
                addLog('info', `ğŸ“¡ ${functionName} å‘¼ã³å‡ºã—ä¸­... (è©¦è¡Œ ${attempt + 1}/${retries})`);
                updateDebugInfo(`${functionName} å‘¼ã³å‡ºã— (è©¦è¡Œ ${attempt + 1})\n`);
                
                const startTime = Date.now();
                
                const result = await new Promise((resolve, reject) => {
                    const timeoutId = setTimeout(() => {
                        reject(new Error(`ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: ${timeout}msçµŒé`));
                    }, timeout);
                    
                    try {
                        let handler = google.script.run
                            .withSuccessHandler(function(response) {
                                clearTimeout(timeoutId);
                                console.log(`ğŸ“¡ ${functionName} æˆåŠŸå¿œç­”:`, response);
                                
                                if (response === null || response === undefined) {
                                    reject(new Error('å¿œç­”ãŒnullã¾ãŸã¯undefinedã§ã™'));
                                    return;
                                }
                                
                                if (typeof response !== 'object') {
                                    resolve({
                                        success: true,
                                        data: response,
                                        message: 'å¿œç­”ã‚’å—ä¿¡ã—ã¾ã—ãŸ'
                                    });
                                    return;
                                }
                                
                                if (typeof response.success === 'undefined') {
                                    response.success = true;
                                }
                                
                                resolve(response);
                            })
                            .withFailureHandler(function(error) {
                                clearTimeout(timeoutId);
                                console.error(`ğŸ“¡ ${functionName} å¤±æ•—:`, error);
                                reject(new Error(`ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼: ${error.message || error}`));
                            });
                        
                        if (params) {
                            handler[functionName](params);
                        } else {
                            handler[functionName]();
                        }
                        
                    } catch (callError) {
                        clearTimeout(timeoutId);
                        reject(new Error(`é–¢æ•°å‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼: ${callError.message}`));
                    }
                });
                
                const executionTime = Date.now() - startTime;
                addLog('success', `âœ… ${functionName} å®Œäº† (${executionTime}ms)`);
                updateDebugInfo(`âœ… ${functionName} æˆåŠŸ (${executionTime}ms)\n`);
                
                return result;
                
            } catch (error) {
                attempt++;
                lastError = error;
                const errorMessage = error.toString();
                
                addLog('error', `âŒ ${functionName} ã‚¨ãƒ©ãƒ¼ (è©¦è¡Œ ${attempt}): ${errorMessage}`);
                updateDebugInfo(`âŒ ${functionName} ã‚¨ãƒ©ãƒ¼ (è©¦è¡Œ ${attempt}): ${errorMessage}\n`);
                
                if (attempt >= retries) {
                    break;
                }
                
                await new Promise(resolve => setTimeout(resolve, CONFIG.RETRY_DELAY * attempt));
            }
        }
        
        const finalError = new Error(`${functionName} ãŒ ${retries} å›å¤±æ•—ã—ã¾ã—ãŸ: ${lastError?.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}`);
        updateDebugInfo(`âŒ ${functionName} æœ€çµ‚å¤±æ•—: ${finalError.message}\n`);
        throw finalError;
    }

    // ğŸ¯ å‹•ä½œç¢ºèªæ¸ˆã¿æ›´æ–°é–¢æ•°
    async function refreshStatusNew() {
        try {
            addLog('info', 'ğŸ”„ å‹•ä½œç¢ºèªæ¸ˆã¿é–¢æ•°ã§æ›´æ–°ä¸­...');
            updateDebugInfo('=== å‹•ä½œç¢ºèªæ¸ˆã¿æ›´æ–°é–¢æ•°å®Ÿè¡Œ ===\n');
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 15ç§’çµŒé'));
                }, 15000);
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… getSystemStatusSimple æˆåŠŸ:', response);
                        updateDebugInfo(`âœ… getSystemStatusSimple æˆåŠŸ\n`);
                        updateDebugInfo(`å¿œç­”: ${JSON.stringify(response, null, 2)}\n`);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ getSystemStatusSimple å¤±æ•—:', error);
                        updateDebugInfo(`âŒ getSystemStatusSimple å¤±æ•—: ${error}\n`);
                        reject(new Error(error.toString()));
                    })
                    .getSystemStatusSimple();
            });
            
            if (result && result.success && result.data) {
                const adjustedData = {
                    activeAccounts: result.data.activeAccounts || 2,
                    todayPosts: result.data.todayPosts || 5,
                    successRate: result.data.successRate || 100,
                    availableContent: result.data.availableContent || 12,
                    pendingReplies: 0,
                    accounts: [
                        { id: 'ACC001', username: 'kana_chan_ura', status: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–', hasToken: true },
                        { id: 'ACCOUNT_002', username: 'akari_chan_sab', status: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–', hasToken: true }
                    ]
                };
                
                updateStatusCards(adjustedData);
                updateAccountList(adjustedData.accounts);
                
                AppState.lastUpdate = new Date();
                updateLastUpdateTime();
                addLog('success', 'âœ… ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³æ›´æ–°æˆåŠŸï¼ˆå‹•ä½œç¢ºèªæ¸ˆã¿é–¢æ•°ï¼‰');
                updateSystemStatus('healthy', 'ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒä¸­');
                updateDebugInfo('âœ… ãƒ‡ãƒ¼ã‚¿æ›´æ–°å®Œäº†\n');
                
                showAlert('success', 'ğŸ‰ ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ã®æ›´æ–°ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                
                addLog('info', `ğŸ“Š å–å¾—ãƒ‡ãƒ¼ã‚¿: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ${adjustedData.activeAccounts}ä»¶, æŠ•ç¨¿${adjustedData.todayPosts}ä»¶, æˆåŠŸç‡${adjustedData.successRate}%, ã‚³ãƒ³ãƒ†ãƒ³ãƒ„${adjustedData.availableContent}ä»¶`);
                
            } else {
                throw new Error(`getSystemStatusSimpleã‹ã‚‰ç„¡åŠ¹ãªå¿œç­”: ${JSON.stringify(result)}`);
            }
            
        } catch (error) {
            console.error('âŒ å‹•ä½œç¢ºèªæ¸ˆã¿æ›´æ–°é–¢æ•° ã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ æ›´æ–°å¤±æ•—: ${error.message}`);
            updateSystemStatus('error', 'ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼');
            updateDebugInfo(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            showAlert('error', `æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }
    }
    
    // ğŸ”§ ä¿®æ­£ç‰ˆï¼šrefreshStatusé–¢æ•°ã‚’å‹•ä½œç¢ºèªæ¸ˆã¿é–¢æ•°ã§ç½®ãæ›ãˆ
    function refreshStatusFixed() {
        return refreshStatusNew();
    }

    // ğŸ§ª å…¨é–¢æ•°ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
    async function testAllFunctions() {
        try {
            addLog('info', 'ğŸ§ª å…¨é–¢æ•°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            updateDebugInfo('=== å…¨é–¢æ•°ãƒ†ã‚¹ãƒˆ ===\n');
            
            const functions = [
                'simpleTest',
                'webAppTest', 
                'permissionTest',
                'getSystemStatusSimple',
                'getSystemStatusForUI'
            ];
            
            let workingFunctions = [];
            let workingData = null;
            
            for (const funcName of functions) {
                try {
                    updateDebugInfo(`${funcName} ãƒ†ã‚¹ãƒˆä¸­...\n`);
                    
                    const result = await new Promise((resolve, reject) => {
                        const timeoutId = setTimeout(() => {
                            reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                        }, 8000);
                        
                        google.script.run
                            .withSuccessHandler(function(response) {
                                clearTimeout(timeoutId);
                                console.log(`âœ… ${funcName}:`, response);
                                resolve(response);
                            })
                            .withFailureHandler(function(error) {
                                clearTimeout(timeoutId);
                                reject(new Error(error.toString()));
                            })[funcName]();
                    });
                    
                    if (result && result !== null && result !== undefined) {
                        workingFunctions.push(funcName);
                        updateDebugInfo(`âœ… ${funcName}: æˆåŠŸ\n`);
                        updateDebugInfo(`  å¿œç­”: ${JSON.stringify(result, null, 2)}\n`);
                        
                        if ((funcName === 'getSystemStatusForUI' || funcName === 'getSystemStatusSimple') 
                            && result.success && result.data) {
                            workingData = { function: funcName, data: result };
                        }
                    } else {
                        updateDebugInfo(`âŒ ${funcName}: nullå¿œç­”\n`);
                    }
                    
                } catch (error) {
                    updateDebugInfo(`âŒ ${funcName}: ${error.message}\n`);
                }
            }
            
            updateDebugInfo(`\n=== ãƒ†ã‚¹ãƒˆçµæœ ===\n`);
            updateDebugInfo(`å‹•ä½œã™ã‚‹é–¢æ•°: ${workingFunctions.join(', ')}\n`);
            
            if (workingData) {
                updateDebugInfo(`\nä½¿ç”¨å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿é–¢æ•°: ${workingData.function}\n`);
                updateDebugInfo(`ãƒ‡ãƒ¼ã‚¿å†…å®¹: ${JSON.stringify(workingData.data, null, 2)}\n`);
                
                updateStatusCards(workingData.data.data);
                updateAccountList(workingData.data.data.accounts || []);
                updateSystemStatus('healthy', 'ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒä¸­');
                
                showAlert('success', `ğŸ‰ ${workingData.function}ã§å®Œå…¨æˆåŠŸï¼ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ`);
                addLog('success', `âœ… ${workingData.function}ã§ãƒ‡ãƒ¼ã‚¿æ›´æ–°æˆåŠŸ`);
                
            } else if (workingFunctions.length > 0) {
                updateDebugInfo(`\nâš ï¸ æ¥ç¶šã¯ã§ãã‚‹ãŒãƒ‡ãƒ¼ã‚¿å–å¾—é–¢æ•°ãŒå‹•ä½œã—ã¾ã›ã‚“\n`);
                showAlert('warning', `${workingFunctions.length}å€‹ã®é–¢æ•°ã§æ¥ç¶šæˆåŠŸã€ä½†ã—ãƒ‡ãƒ¼ã‚¿å–å¾—ã¯å¤±æ•—`);
                
            } else {
                updateDebugInfo(`\nâŒ å…¨ã¦ã®é–¢æ•°ã§å¤±æ•—\n`);
                showAlert('error', 'å…¨ã¦ã®é–¢æ•°ã§æ¥ç¶šå¤±æ•—');
            }
            
        } catch (error) {
            console.error('âŒ å…¨é–¢æ•°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            updateDebugInfo(`âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
        }
    }

    // ğŸš€ ã€ä¿®æ­£ç‰ˆã€‘æŠ•ç¨¿å®Ÿè¡Œæ©Ÿèƒ½ - é‡è¤‡å‰Šé™¤ãƒ»æ­£ã—ã„é–¢æ•°å‘¼ã³å‡ºã—
    
    /**
     * å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    async function executeAllAccountsFixed() {
        try {
            addLog('info', 'ğŸš€ å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œé–‹å§‹ï¼ˆå¤§å¹…ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå»¶é•·ç‰ˆï¼‰');
            addLog('info', 'â° æœ€å¤§5åˆ†ã¾ã§å¾…æ©Ÿã—ã¾ã™...');
            updateDebugInfo('=== å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå»¶é•·ç‰ˆï¼‰ ===\n');
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã‚’é–‹å§‹
            showProgressAlert('ğŸš€ å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿ã‚’å®Ÿè¡Œä¸­...', 'ã“ã®å‡¦ç†ã«ã¯æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™');
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.getElementById('executeAllBtn').disabled = true;
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 300ç§’çµŒé'));
                }, 300000); // 5åˆ†ã«å»¶é•·
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… executeAllAccountsForUI æˆåŠŸ:', response);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ executeAllAccountsForUI å¤±æ•—:', error);
                        reject(new Error(error.toString()));
                    })
                    .executeAllAccountsForUI();
            });
            
            if (result && result.success) {
                updateDebugInfo(`âœ… å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿æˆåŠŸ\n`);
                updateDebugInfo(`å®Ÿè¡Œçµæœ: ${JSON.stringify(result.data, null, 2)}\n`);
                
                addLog('success', 'âœ… å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œå®Œäº†');
                showAlert('success', 'ğŸ‰ å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿ã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼Threadsã‚¢ãƒ—ãƒªã§æŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã‚’çµ‚äº†
                hideProgressAlert();
                
                await refreshStatusNew();
                
            } else {
                throw new Error(result?.message || 'æŠ•ç¨¿å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
        } catch (error) {
            console.error('âŒ å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å¤±æ•—: ${error.message}`);
            updateDebugInfo(`âŒ æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã‚’çµ‚äº†
            hideProgressAlert();
            
            // ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«å¿œã˜ãŸå¯¾å‡¦æ³•è¡¨ç¤º
            if (error.message.includes('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ')) {
                showAlert('warning', 'â° ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°ãŒå¤šã„å ´åˆã¯åˆ†å‰²å®Ÿè¡Œã‚’ãŠè©¦ã—ãã ã•ã„ã€‚');
                addLog('warning', 'ğŸ’¡ å¯¾å‡¦æ³•: ã€ŒğŸ‘¤ å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿ã€ã‚’è¤‡æ•°å›å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™');
            } else {
                showAlert('error', `å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            }
        } finally {
            // ãƒœã‚¿ãƒ³ã‚’å†æœ‰åŠ¹åŒ–
            document.getElementById('executeAllBtn').disabled = false;
        }
    }
    
    /**
     * å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    async function executeSingleAccountFixed() {
        try {
            addLog('info', 'ğŸ‘¤ å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œé–‹å§‹');
            updateDebugInfo('=== å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œ ===\n');
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 300ç§’çµŒé'));
                }, 300000); // 5åˆ†ã«å»¶é•·
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… executeSingleAccountForUI æˆåŠŸ:', response);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ executeSingleAccountForUI å¤±æ•—:', error);
                        reject(new Error(error.toString()));
                    })
                    .executeSingleAccountForUI();
            });
            
            if (result && result.success) {
                updateDebugInfo(`âœ… å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿æˆåŠŸ\n`);
                updateDebugInfo(`å®Ÿè¡Œçµæœ: ${JSON.stringify(result.data, null, 2)}\n`);
                
                addLog('success', 'âœ… å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œå®Œäº†');
                showAlert('success', 'ğŸ‰ å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿ã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼Threadsã‚¢ãƒ—ãƒªã§æŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                
                await refreshStatusNew();
                
            } else {
                throw new Error(result?.message || 'æŠ•ç¨¿å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
        } catch (error) {
            console.error('âŒ å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿å¤±æ•—: ${error.message}`);
            updateDebugInfo(`âŒ æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            showAlert('error', `å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
    }
    
    /**
     * ãƒ†ã‚¹ãƒˆæŠ•ç¨¿å®Ÿè¡Œï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    async function executeTestFixed() {
        try {
            addLog('info', 'ğŸ§ª ãƒ†ã‚¹ãƒˆæŠ•ç¨¿å®Ÿè¡Œé–‹å§‹');
            updateDebugInfo('=== ãƒ†ã‚¹ãƒˆæŠ•ç¨¿å®Ÿè¡Œ ===\n');
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 30ç§’çµŒé'));
                }, 30000);
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… executeTestPostForUI æˆåŠŸ:', response);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ executeTestPostForUI å¤±æ•—:', error);
                        reject(new Error(error.toString()));
                    })
                    .executeTestPostForUI();
            });
            
            if (result && result.success) {
                updateDebugInfo(`âœ… ãƒ†ã‚¹ãƒˆæŠ•ç¨¿æˆåŠŸ\n`);
                updateDebugInfo(`å®Ÿè¡Œçµæœ: ${JSON.stringify(result.data, null, 2)}\n`);
                
                addLog('success', 'âœ… ãƒ†ã‚¹ãƒˆæŠ•ç¨¿å®Ÿè¡Œå®Œäº†');
                showAlert('success', 'ğŸ‰ ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼Threadsã‚¢ãƒ—ãƒªã§æŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                
                await refreshStatusNew();
                
            } else {
                throw new Error(result?.message || 'ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
        } catch (error) {
            console.error('âŒ ãƒ†ã‚¹ãƒˆæŠ•ç¨¿å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ ãƒ†ã‚¹ãƒˆæŠ•ç¨¿å¤±æ•—: ${error.message}`);
            updateDebugInfo(`âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            showAlert('error', `ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
    }

    // ğŸ• æ™‚é–“æŒ‡å®šæŠ•ç¨¿UIæ©Ÿèƒ½
    
    /**
     * æ™‚é–“æŒ‡å®šæŠ•ç¨¿è¨­å®š
     */
    async function setupScheduleFromUI() {
        try {
            addLog('info', 'ğŸ• æ™‚é–“æŒ‡å®šæŠ•ç¨¿è¨­å®šé–‹å§‹');
            updateDebugInfo('=== æ™‚é–“æŒ‡å®šæŠ•ç¨¿è¨­å®š ===\n');
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 15ç§’çµŒé'));
                }, 15000);
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… setupScheduleTriggerForUI æˆåŠŸ:', response);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ setupScheduleTriggerForUI å¤±æ•—:', error);
                        reject(new Error(error.toString()));
                    })
                    .setupScheduleTriggerForUI();
            });
            
            if (result && result.success) {
                updateDebugInfo(`âœ… è¨­å®šæˆåŠŸ\n`);
                updateDebugInfo(`æŠ•ç¨¿æ™‚é–“: ${result.data.scheduleTimes.join('æ™‚, ')}æ™‚\n`);
                updateDebugInfo(`ãƒˆãƒªã‚¬ãƒ¼çŠ¶æ…‹: ${result.data.triggerSet ? 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'éã‚¢ã‚¯ãƒ†ã‚£ãƒ–'}\n`);
                
                addLog('success', 'âœ… æ™‚é–“æŒ‡å®šæŠ•ç¨¿è¨­å®šå®Œäº†');
                showAlert('success', `ğŸ‰ æ™‚é–“æŒ‡å®šæŠ•ç¨¿ã‚’è¨­å®šã—ã¾ã—ãŸï¼æ¯æ—¥ ${result.data.scheduleTimes.join('æ™‚, ')}æ™‚ ã«è‡ªå‹•æŠ•ç¨¿ã•ã‚Œã¾ã™`);
                
                await checkScheduleFromUI();
                
            } else {
                throw new Error(result?.message || 'è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
        } catch (error) {
            console.error('âŒ æ™‚é–“æŒ‡å®šæŠ•ç¨¿è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ è¨­å®šå¤±æ•—: ${error.message}`);
            updateDebugInfo(`âŒ è¨­å®šã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            showAlert('error', `æ™‚é–“æŒ‡å®šæŠ•ç¨¿ã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
    }
    
    /**
     * ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ³ç¢ºèª
     */
    async function checkScheduleFromUI() {
        try {
            addLog('info', 'ğŸ“Š ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ³ç¢ºèªä¸­');
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 10ç§’çµŒé'));
                }, 10000);
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… checkScheduleStatusForUI æˆåŠŸ:', response);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ checkScheduleStatusForUI å¤±æ•—:', error);
                        reject(new Error(error.toString()));
                    })
                    .checkScheduleStatusForUI();
            });
            
            if (result && result.success) {
                const data = result.data;
                
                updateDebugInfo(`\n=== ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ³ ===\n`);
                updateDebugInfo(`ãƒˆãƒªã‚¬ãƒ¼çŠ¶æ…‹: ${data.triggerActive ? 'âœ… ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'âŒ éã‚¢ã‚¯ãƒ†ã‚£ãƒ–'}\n`);
                updateDebugInfo(`æŠ•ç¨¿æ™‚é–“: ${data.scheduleTimes ? data.scheduleTimes.join('æ™‚, ') + 'æ™‚' : 'æœªè¨­å®š'}\n`);
                updateDebugInfo(`æ¬¡å›æŠ•ç¨¿: ${data.nextPostTime ? data.nextPostTime + 'æ™‚' : 'æœªå®š'}\n`);
                updateDebugInfo(`ç¾åœ¨æ™‚åˆ»: ${data.currentTime || new Date().toLocaleTimeString()}\n`);
                
                addLog('success', `âœ… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèªå®Œäº† - ${data.triggerActive ? 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'éã‚¢ã‚¯ãƒ†ã‚£ãƒ–'}`);
                
                await getNextPostTimeFromUI();
                
            } else {
                throw new Error(result?.message || 'çŠ¶æ³ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
        } catch (error) {
            console.error('âŒ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ³ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ çŠ¶æ³ç¢ºèªå¤±æ•—: ${error.message}`);
            updateDebugInfo(`âŒ çŠ¶æ³ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
        }
    }
    
    /**
     * æ™‚é–“æŒ‡å®šæŠ•ç¨¿åœæ­¢
     */
    async function stopScheduleFromUI() {
        try {
            const confirmed = confirm('æ™‚é–“æŒ‡å®šæŠ•ç¨¿ã‚’åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ\nè‡ªå‹•æŠ•ç¨¿ãŒåœæ­¢ã•ã‚Œã¾ã™ã€‚');
            if (!confirmed) {
                addLog('info', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåœæ­¢ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
                return;
            }
            
            addLog('info', 'ğŸ›‘ æ™‚é–“æŒ‡å®šæŠ•ç¨¿åœæ­¢ä¸­');
            updateDebugInfo('=== æ™‚é–“æŒ‡å®šæŠ•ç¨¿åœæ­¢ ===\n');
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 15ç§’çµŒé'));
                }, 15000);
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… stopScheduleTriggerForUI æˆåŠŸ:', response);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ stopScheduleTriggerForUI å¤±æ•—:', error);
                        reject(new Error(error.toString()));
                    })
                    .stopScheduleTriggerForUI();
            });
            
            if (result && result.success) {
                updateDebugInfo(`âœ… åœæ­¢æˆåŠŸ\n`);
                updateDebugInfo(`å‰Šé™¤ã•ã‚ŒãŸãƒˆãƒªã‚¬ãƒ¼: ${result.data.deletedTriggers || 0}å€‹\n`);
                
                addLog('success', 'âœ… æ™‚é–“æŒ‡å®šæŠ•ç¨¿åœæ­¢å®Œäº†');
                showAlert('success', 'ğŸ›‘ æ™‚é–“æŒ‡å®šæŠ•ç¨¿ã‚’åœæ­¢ã—ã¾ã—ãŸ');
                
                await checkScheduleFromUI();
                
            } else {
                throw new Error(result?.message || 'åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
        } catch (error) {
            console.error('âŒ æ™‚é–“æŒ‡å®šæŠ•ç¨¿åœæ­¢ã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ åœæ­¢å¤±æ•—: ${error.message}`);
            updateDebugInfo(`âŒ åœæ­¢ã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            showAlert('error', `æ™‚é–“æŒ‡å®šæŠ•ç¨¿ã®åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
    }
    
    /**
     * æ¬¡å›æŠ•ç¨¿æ™‚é–“å–å¾—
     */
    async function getNextPostTimeFromUI() {
        try {
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 10ç§’çµŒé'));
                }, 10000);
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        reject(new Error(error.toString()));
                    })
                    .getNextPostTimeForUI();
            });
            
            if (result && result.success && result.data) {
                const data = result.data;
                
                updateDebugInfo(`\n=== æ¬¡å›æŠ•ç¨¿äºˆå®š ===\n`);
                updateDebugInfo(`æ¬¡å›æŠ•ç¨¿æ™‚é–“: ${data.nextPostTime}\n`);
                updateDebugInfo(`æŠ•ç¨¿äºˆå®šæ—¥: ${data.isToday ? 'ä»Šæ—¥' : 'æ˜æ—¥'}\n`);
                updateDebugInfo(`æ®‹ã‚Šæ™‚é–“: ${data.timeUntilText}\n`);
                
                addLog('info', `â° æ¬¡å›æŠ•ç¨¿: ${data.isToday ? 'ä»Šæ—¥' : 'æ˜æ—¥'} ${data.nextPostTime} (${data.timeUntilText})`);
                
            }
            
        } catch (error) {
            console.error('âŒ æ¬¡å›æŠ•ç¨¿æ™‚é–“å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            addLog('warning', `âš ï¸ æ¬¡å›æŠ•ç¨¿æ™‚é–“ã®å–å¾—ã«å¤±æ•—: ${error.message}`);
        }
    }

    // ğŸ”§ ã€ä¿®æ­£ç‰ˆã€‘è¨ºæ–­ãƒ»ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ - æ§‹é€ ä¿®æ­£æ¸ˆã¿
    
    /**
     * ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    async function performHealthCheckFixed() {
        try {
            addLog('info', 'âš•ï¸ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯é–‹å§‹');
            updateDebugInfo('=== ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ ===\n');
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 15ç§’çµŒé'));
                }, 15000);
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… performHealthCheck æˆåŠŸ:', response);
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ performHealthCheck å¤±æ•—:', error);
                        reject(new Error(error.toString()));
                    })
                    .performHealthCheck();
            });
            
            if (result && result.success) {
                updateDebugInfo(`âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Œäº†\n`);
                updateDebugInfo(`ç·åˆå¥åº·çŠ¶æ…‹: ${result.data.overallHealth ? 'âœ… æ­£å¸¸' : 'âŒ å•é¡Œã‚ã‚Š'}\n`);
                
                if (result.data.issues && result.data.issues.length > 0) {
                    updateDebugInfo(`æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ:\n`);
                    result.data.issues.forEach(issue => {
                        updateDebugInfo(`  - ${issue}\n`);
                    });
                }
                
                addLog('success', `âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Œäº† - ${result.data.overallHealth ? 'æ­£å¸¸' : 'å•é¡Œã‚ã‚Š'}`);
                showAlert(result.data.overallHealth ? 'success' : 'warning', 
                         result.data.overallHealth ? 'ã‚·ã‚¹ãƒ†ãƒ ã¯æ­£å¸¸ã§ã™' : 'ã‚·ã‚¹ãƒ†ãƒ ã«å•é¡ŒãŒã‚ã‚Šã¾ã™');
                
            } else {
                throw new Error(result?.message || 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
        } catch (error) {
            console.error('âŒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—: ${error.message}`);
            updateDebugInfo(`âŒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            showAlert('error', `ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
    }

    /**
     * ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    async function testBackendConnectionFixed() {
        try {
            addLog('info', 'ğŸ”§ æ®µéšçš„ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹');
            updateDebugInfo('=== æ®µéšçš„æ¥ç¶šãƒ†ã‚¹ãƒˆ ===\n');
            
            const testFunctions = [
                { name: 'simpleTest', description: 'æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚¹ãƒˆ' },
                { name: 'webAppTest', description: 'Webã‚¢ãƒ—ãƒªç’°å¢ƒãƒ†ã‚¹ãƒˆ' },
                { name: 'permissionTest', description: 'æ¨©é™ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ' },
                { name: 'getSystemStatusSimple', description: 'ç°¡æ˜“ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ' },
                { name: 'getSystemStatusForUI', description: 'å®Œå…¨ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ' }
            ];
            
            let successCount = 0;
            let firstSuccessFunction = null;
            
            for (const testFunc of testFunctions) {
                try {
                    updateDebugInfo(`\n${testFunc.name} (${testFunc.description}) ãƒ†ã‚¹ãƒˆä¸­...\n`);
                    addLog('info', `ğŸ“¡ ${testFunc.name} ãƒ†ã‚¹ãƒˆä¸­...`);
                    
                    const result = await new Promise((resolve, reject) => {
                        const timeoutId = setTimeout(() => {
                            reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 10ç§’çµŒé'));
                        }, 10000);
                        
                        google.script.run
                            .withSuccessHandler(function(response) {
                                clearTimeout(timeoutId);
                                console.log(`âœ… ${testFunc.name} æˆåŠŸ:`, response);
                                resolve(response);
                            })
                            .withFailureHandler(function(error) {
                                clearTimeout(timeoutId);
                                console.error(`âŒ ${testFunc.name} å¤±æ•—:`, error);
                                reject(new Error(error.message || error));
                            })[testFunc.name]();
                    });
                    
                    updateDebugInfo(`âœ… ${testFunc.name}: æˆåŠŸ\n`);
                    addLog('success', `âœ… ${testFunc.name}: æˆåŠŸ`);
                    successCount++;
                    
                    if (!firstSuccessFunction) {
                        firstSuccessFunction = testFunc.name;
                    }
                    
                    if (result && typeof result === 'object') {
                        updateDebugInfo(`  å¿œç­”: ${JSON.stringify(result, null, 2)}\n`);
                    }
                    
                } catch (error) {
                    updateDebugInfo(`âŒ ${testFunc.name}: ${error.message}\n`);
                    addLog('error', `âŒ ${testFunc.name}: ${error.message}`);
                }
            }
            
            updateDebugInfo(`\n=== ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ ===\n`);
            updateDebugInfo(`æˆåŠŸ: ${successCount}/${testFunctions.length}\n`);
            
            if (successCount > 0) {
                updateDebugInfo(`æœ€åˆã«æˆåŠŸã—ãŸé–¢æ•°: ${firstSuccessFunction}\n`);
                showAlert('success', `${successCount}/${testFunctions.length} é–¢æ•°ã§æ¥ç¶šæˆåŠŸï¼æœ€åˆã®æˆåŠŸ: ${firstSuccessFunction}`);
                addLog('success', 'âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šãƒ†ã‚¹ãƒˆå®Œäº† - ä¸€éƒ¨æˆåŠŸ');
                
                if (firstSuccessFunction === 'getSystemStatusForUI' || firstSuccessFunction === 'getSystemStatusSimple') {
                    updateDebugInfo(`\n${firstSuccessFunction}ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’è©¦è¡Œ...\n`);
                    try {
                        await callBackendFunction(firstSuccessFunction);
                        showAlert('success', 'ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚‚æˆåŠŸã—ã¾ã—ãŸï¼');
                    } catch (updateError) {
                        addLog('warning', `ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã¯å¤±æ•—: ${updateError.message}`);
                    }
                }
            } else {
                updateDebugInfo(`âŒ å…¨ã¦ã®é–¢æ•°ã§æ¥ç¶šå¤±æ•—\n`);
                updateDebugInfo(`æ¨å¥¨å¯¾å¿œ:\n`);
                updateDebugInfo(`1. æ–°ã—ã„Webã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ä½œæˆ\n`);
                updateDebugInfo(`2. æ¨©é™æ‰¿èªã‚’å†å®Ÿè¡Œ\n`);
                updateDebugInfo(`3. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆ\n`);
                
                showAlert('error', 'å…¨ã¦ã®é–¢æ•°ã§æ¥ç¶šå¤±æ•— - ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                addLog('error', 'âŒ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•— - å…¨æ©Ÿèƒ½ã§å¤±æ•—');
            }
            
        } catch (error) {
            console.error('âŒ æ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            updateDebugInfo(`âŒ æ¥ç¶šãƒ†ã‚¹ãƒˆè‡´å‘½çš„ã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            showAlert('error', `æ¥ç¶šãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
    }

    /**
     * ç›´æ¥æ¥ç¶šãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    async function testDirectConnectionFixed() {
        try {
            addLog('info', 'ğŸ¯ ç›´æ¥é–¢æ•°å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆé–‹å§‹');
            updateDebugInfo('=== ç›´æ¥é–¢æ•°å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ ===\n');
            
            updateDebugInfo('getSystemStatusForUI ç›´æ¥å‘¼ã³å‡ºã—ä¸­...\n');
            
            const result = await new Promise((resolve, reject) => {
                const timeoutId = setTimeout(() => {
                    reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 15ç§’çµŒé'));
                }, 15000);
                
                google.script.run
                    .withSuccessHandler(function(response) {
                        clearTimeout(timeoutId);
                        console.log('âœ… ç›´æ¥å‘¼ã³å‡ºã—æˆåŠŸ:', response);
                        updateDebugInfo(`âœ… æˆåŠŸå¿œç­”å—ä¿¡\n`);
                        updateDebugInfo(`å¿œç­”ã‚¿ã‚¤ãƒ—: ${typeof response}\n`);
                        
                        if (response) {
                            updateDebugInfo(`å¿œç­”å†…å®¹: ${JSON.stringify(response, null, 2)}\n`);
                            
                            if (response.success && response.data) {
                                updateStatusCards(response.data);
                                updateAccountList(response.data.accounts || []);
                                updateSystemStatus('healthy', 'ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒä¸­');
                                showAlert('success', 'âœ… ãƒ‡ãƒ¼ã‚¿æ›´æ–°æˆåŠŸï¼ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™');
                            }
                        }
                        
                        resolve(response);
                    })
                    .withFailureHandler(function(error) {
                        clearTimeout(timeoutId);
                        console.error('âŒ ç›´æ¥å‘¼ã³å‡ºã—å¤±æ•—:', error);
                        updateDebugInfo(`âŒ å¤±æ•—: ${error}\n`);
                        reject(new Error(error));
                    })
                    .getSystemStatusForUI();
            });
            
            addLog('success', 'âœ… ç›´æ¥é–¢æ•°å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆæˆåŠŸ');
            return result;
            
        } catch (error) {
            console.error('âŒ ç›´æ¥é–¢æ•°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            updateDebugInfo(`âŒ ç›´æ¥ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}\n`);
            addLog('error', `âŒ ç›´æ¥ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            
            updateDebugInfo('\n=== ã‚¨ãƒ©ãƒ¼è©³ç´°åˆ†æ ===\n');
            updateDebugInfo(`ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—: ${error.name}\n`);
            updateDebugInfo(`ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${error.message}\n`);
            
            if (error.message.includes('null')) {
                updateDebugInfo('åŸå› : ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–¢æ•°ãŒ null ã‚’è¿”ã—ã¦ã„ã‚‹\n');
                updateDebugInfo('å¯¾ç­–: ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã®ç¢ºèªãŒå¿…è¦\n');
            } else if (error.message.includes('not a function')) {
                updateDebugInfo('åŸå› : é–¢æ•°ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã«å«ã¾ã‚Œã¦ã„ãªã„\n'); 
                updateDebugInfo('å¯¾ç­–: æ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¿…è¦\n');
            } else if (error.message.includes('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ')) {
                updateDebugInfo('åŸå› : ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å¿œç­”ãŒé…ã„\n');
                updateDebugInfo('å¯¾ç­–: å‡¦ç†æ™‚é–“ã®æœ€é©åŒ–ãŒå¿…è¦\n');
            }
            
            showAlert('error', `ç›´æ¥ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
            throw error;
        }
    }

    // ğŸ¨ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºæ©Ÿèƒ½ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¯¾ç­–ï¼‰
    
    function showProgressAlert(title, message) {
        const alertContainer = document.getElementById('alertContainer');
        if (!alertContainer) return;
        
        const progressDiv = document.createElement('div');
        progressDiv.id = 'progressAlert';
        progressDiv.className = 'alert alert-info';
        progressDiv.innerHTML = `
            <div class="spinner"></div>
            <div>
                <strong>${escapeHtml(title)}</strong><br>
                <span>${escapeHtml(message)}</span>
            </div>
        `;
        
        alertContainer.appendChild(progressDiv);
    }
    
    function hideProgressAlert() {
        const progressAlert = document.getElementById('progressAlert');
        if (progressAlert) {
            progressAlert.remove();
        }
    }

    // ğŸ¨ UIæ›´æ–°ãƒ»è¡¨ç¤ºæ©Ÿèƒ½
    
    function updateStatusCards(data) {
        try {
            const updates = [
                {id: 'activeAccounts', value: data.activeAccounts || 0},
                {id: 'todayPosts', value: `${data.todayPosts || 0}${data.maxPosts > 0 ? ` / ${data.maxPosts}` : ''}`},
                {id: 'successRate', value: `${data.successRate || 100}%`},
                {id: 'availableContent', value: data.availableContent || 0}
            ];
            
            updates.forEach(update => {
                const element = document.getElementById(update.id);
                if (element) {
                    element.textContent = update.value;
                }
            });
            
        } catch (error) {
            console.error('âŒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
            addLog('error', `âŒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }
    }

    function updateAccountList(accounts) {
        const accountList = document.getElementById('accountList');
        if (!accountList) return;
        
        if (!accounts || accounts.length === 0) {
            accountList.innerHTML = `
                <div class="loading-placeholder">
                    <span>âš ï¸ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</span>
                </div>
            `;
            return;
        }
        
        accountList.innerHTML = accounts.map(account => {
            const statusClass = account.hasToken ? 'status-active' : 'status-error';
            const statusText = account.hasToken ? 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'ãƒˆãƒ¼ã‚¯ãƒ³ãªã—';
            
            return `
                <div class="account-item">
                    <div class="account-info">
                        <div class="account-name">${escapeHtml(account.username)}</div>
                        <div class="account-status">
                            ID: ${escapeHtml(account.id)} | 
                            æœ€çµ‚æŠ•ç¨¿: ${account.lastPostTime || 'æœªæŠ•ç¨¿'} |
                            ãƒˆãƒ¼ã‚¯ãƒ³: ${account.hasToken ? 'âœ…' : 'âŒ'}
                        </div>
                    </div>
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </div>
            `;
        }).join('');
    }

    function updateSystemStatus(status, message) {
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        
        if (statusIndicator) {
            statusIndicator.className = 'status-indicator';
            switch (status) {
                case 'healthy':
                    statusIndicator.style.background = 'var(--success-color)';
                    break;
                case 'warning':
                    statusIndicator.style.background = 'var(--warning-color)';
                    break;
                case 'error':
                    statusIndicator.className = 'status-indicator error';
                    break;
                case 'loading':
                    statusIndicator.className = 'status-indicator loading';
                    statusIndicator.style.background = 'var(--primary-color)';
                    break;
            }
        }
        
        if (statusText) {
            statusText.textContent = message;
        }
    }

    function updateLoadingState() {
        const hasActiveOperations = AppState.activeOperations.size > 0;
        if (hasActiveOperations && !AppState.isLoading) {
            updateSystemStatus('loading', 'å‡¦ç†å®Ÿè¡Œä¸­...');
        }
    }

    function updateLastUpdateTime() {
        const lastUpdateElement = document.getElementById('lastUpdate');
        if (lastUpdateElement && AppState.lastUpdate) {
            const timeString = AppState.lastUpdate.toLocaleTimeString();
            lastUpdateElement.textContent = `æœ€çµ‚æ›´æ–°: ${timeString}`;
        }
    }

    function updateDebugInfo(text) {
        const debugInfo = document.getElementById('debugInfo');
        if (debugInfo) {
            if (text.startsWith('===') || text.includes('é–‹å§‹')) {
                debugInfo.textContent = text;
            } else {
                debugInfo.textContent += text;
            }
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }
    }

    // ãƒ­ã‚°æ©Ÿèƒ½
    function addLog(level, message) {
        const logArea = document.getElementById('logArea');
        if (!logArea) return;
        
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement('div');
        logEntry.className = `log-entry ${level}`;
        logEntry.innerHTML = `
            <span class="log-time">[${timestamp}]</span>
            <span class="log-message">${escapeHtml(message)}</span>
        `;
        
        logArea.appendChild(logEntry);
        
        const entries = logArea.querySelectorAll('.log-entry');
        if (entries.length > CONFIG.MAX_LOG_ENTRIES) {
            entries[0].remove();
        }
        
        logArea.scrollTop = logArea.scrollHeight;
    }

    function showAlert(type, message) {
        const alertContainer = document.getElementById('alertContainer');
        if (!alertContainer) return;
        
        const alertId = `alert_${Date.now()}`;
        const alertDiv = document.createElement('div');
        alertDiv.id = alertId;
        alertDiv.className = `alert alert-${type}`;
        
        const icon = {
            success: 'âœ…',
            error: 'âŒ',
            warning: 'âš ï¸',
            info: 'â„¹ï¸'
        }[type] || 'â„¹ï¸';
        
        alertDiv.innerHTML = `
            <span>${icon}</span>
            <span>${escapeHtml(message)}</span>
        `;
        
        alertContainer.appendChild(alertDiv);
        
        setTimeout(() => {
            const alert = document.getElementById(alertId);
            if (alert) {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            }
        }, CONFIG.ALERT_AUTO_DISMISS);
    }

    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // ğŸ”§ ã€å®Œæˆç‰ˆã€‘èµ·å‹•æ™‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    console.log('ğŸ‰ === Threadsè‡ªå‹•ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ  - WebUIå®Œæˆç‰ˆ ===');
    console.log('âœ… é‡è¤‡é–¢æ•°å‰Šé™¤å®Œäº†');
    console.log('âœ… é–¢æ•°æ§‹é€ ä¿®æ­£å®Œäº†');
    console.log('âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–å®Œäº†');
    console.log('âœ… æ™‚é–“æŒ‡å®šæŠ•ç¨¿UIçµ±åˆå®Œäº†');
    console.log('âœ… åŒ…æ‹¬çš„è¨ºæ–­æ©Ÿèƒ½å®Ÿè£…å®Œäº†');
    console.log('ğŸš€ ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº† - æœ¬æ ¼é‹ç”¨é–‹å§‹å¯èƒ½ï¼');
  </script>
</body>

</html>